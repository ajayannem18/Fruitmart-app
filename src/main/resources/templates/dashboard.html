<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>FruitMart</title>
    <meta charset="UTF-8">

    <style>
        body {
            margin:0;
            font-family:Arial, sans-serif;
            background:#eef8ee;
        }

        /* ===== HEADER ===== */
        .header {
            background:#2ecc71;
            color:white;
            padding:15px 30px;
            display:flex;
            justify-content:space-between;
            align-items:center;
        }

        .header a {
            color:white;
            text-decoration:none;
            font-weight:bold;
            margin-left:10px;
        }

        /* ===== FILTER BAR ===== */
        .filters {
            background:white;
            padding:15px 30px;
            display:flex;
            gap:15px;
            align-items:center;
            box-shadow:0 4px 10px rgba(0,0,0,.08);
        }

        .filters input {
            padding:8px 10px;
            border-radius:6px;
            border:1px solid #ccc;
            width:160px;
        }

        .filters button {
            background:#2ecc71;
            color:white;
            border:none;
            padding:9px 18px;
            border-radius:6px;
            cursor:pointer;
        }

        /* ===== PRODUCT GRID ===== */
        .grid {
            display:grid;
            grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
            gap:30px;
            padding:40px;
        }

        /* ===== PRODUCT CARD ===== */
        .product-card {
            background:white;
            border-radius:18px;
            box-shadow:0 8px 18px rgba(0,0,0,.15);
            padding:20px;
            text-align:center;
            transition:transform .3s ease, box-shadow .3s ease;
        }

        .product-card:hover {
            transform:translateY(-10px) scale(1.03);
            box-shadow:0 15px 35px rgba(0,0,0,.18);
        }

        .product-card img {
            height:110px;
            object-fit:contain;
            margin-bottom:10px;
        }

        .qty-box {
            display:flex;
            justify-content:center;
            gap:18px;
            margin:15px 0;
        }

        .qty-btn {
            width:36px;
            height:36px;
            border-radius:50%;
            border:none;
            background:#2ecc71;
            color:white;
            font-size:20px;
            cursor:pointer;
        }

        .amount {
            font-weight:bold;
            margin:8px 0;
        }

        .error {
            color:red;
            font-size:13px;
            display:none;
            animation:shake .3s;
        }

        @keyframes shake {
            0% { transform:translateX(0); }
            25% { transform:translateX(-5px); }
            50% { transform:translateX(5px); }
            75% { transform:translateX(-5px); }
            100% { transform:translateX(0); }
        }

        .add-btn {
            background:#27ae60;
            color:white;
            border:none;
            padding:10px 26px;
            border-radius:22px;
            cursor:pointer;
        }
    </style>
</head>

<body>

<!-- ===== HEADER ===== -->
<div class="header">
    <div>üçé <b>FruitMart</b></div>
    <div>
        üëã Hi <b th:text="${username}">User</b> |
        <a href="/profile">Profile</a> |
        <a href="/cart">üõí <span th:text="${cartCount}">0</span></a> |
        <a href="/logout">Logout</a>
    </div>
</div>

<!-- ===== SEARCH & FILTER ===== -->
<form class="filters" method="get" action="/dashboard">
    <input type="text" name="search" placeholder="Search fruit..."
           th:value="${search}">
    <input type="number" name="min" placeholder="Min ‚Çπ"
           th:value="${min}">
    <input type="number" name="max" placeholder="Max ‚Çπ"
           th:value="${max}">
    <button type="submit">Apply</button>
</form>

<!-- ===== PRODUCTS ===== -->
<div class="grid">
    <div class="product-card"
         th:each="fruit : ${fruits}"
         th:data-name="${fruit.name}"
         th:data-price="${fruit.price}">

        <img th:src="${fruit.image}">
        <h3 th:text="${fruit.name}"></h3>

        <p>
            ‚Çπ<span th:text="${fruit.price}"></span> /
            <span th:text="${fruit.unit}"></span>
        </p>

        <div class="qty-box">
            <button class="qty-btn dec">‚àí</button>
            <span class="qty">0</span>
            <button class="qty-btn inc">+</button>
        </div>

        <div class="amount">‚Çπ0</div>
        <div class="error">Please select quantity</div>

        <button class="add-btn">Add to Cart</button>
    </div>
</div>

<!-- ===== SCRIPT ===== -->
<script>
document.querySelectorAll(".product-card").forEach(card => {

    let qty = 0;
    const price = parseInt(card.dataset.price);
    const name = card.dataset.name;

    const qtySpan = card.querySelector(".qty");
    const amountDiv = card.querySelector(".amount");
    const error = card.querySelector(".error");

    card.querySelector(".inc").onclick = () => {
        qty++;
        update();
    };

    card.querySelector(".dec").onclick = () => {
        if (qty > 0) qty--;
        update();
    };

    card.querySelector(".add-btn").onclick = () => {
        if (qty === 0) {
            error.style.display = "block";
            setTimeout(() => error.style.display = "none", 1200);
            return;
        }

        fetch(`/add-to-cart?name=${encodeURIComponent(name)}&qty=${qty}`)
            .then(r => r.json())
            .then(d => {
                if (d.redirect) {
                    window.location.href = d.redirect;
                } else {
                    window.location.reload();
                }
            });
    };

    function update() {
        qtySpan.innerText = qty;
        amountDiv.innerText = "‚Çπ" + (qty * price);
    }
});
</script>

</body>
</html>