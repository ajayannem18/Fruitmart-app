<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>FruitMart | Fresh Fruits</title>
    <meta charset="UTF-8">

    <style>
        body {
            margin:0;
            font-family:Arial, sans-serif;
            background:#f3fbf4;
        }

        /* ===== HEADER ===== */
        .header {
            background:linear-gradient(90deg,#2ecc71,#27ae60);
            color:white;
            padding:35px;
            text-align:center;
        }

        .header h1 {
            margin:0;
            font-size:36px;
        }

        .header p {
            margin-top:8px;
            opacity:.9;
        }

        /* ===== SEARCH ===== */
        .search-box {
            text-align:center;
            margin:25px 0;
        }

        .search-box input {
            width:320px;
            padding:12px;
            border-radius:25px;
            border:1px solid #ccc;
            outline:none;
            font-size:15px;
        }

        /* ===== QUOTES ===== */
        .quotes {
            text-align:center;
            font-style:italic;
            color:#2e7d32;
            margin-bottom:30px;
            animation:fade 4s infinite alternate;
        }

        @keyframes fade {
            from { opacity:.6; }
            to { opacity:1; }
        }

        /* ===== PRODUCT GRID ===== */
        .grid {
            display:grid;
            grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
            gap:30px;
            padding:40px;
        }

        .card {
            background:white;
            border-radius:18px;
            box-shadow:0 10px 20px rgba(0,0,0,.12);
            padding:20px;
            text-align:center;
            transition:.35s;
        }

        .card:hover {
            transform:translateY(-10px) scale(1.03);
            box-shadow:0 18px 35px rgba(0,0,0,.18);
        }

        .card img {
            height:120px;
            object-fit:contain;
            margin-bottom:10px;
        }

        .price {
            font-weight:bold;
            margin-top:5px;
        }

        /* ===== QTY ===== */
        .qty-box {
            display:flex;
            justify-content:center;
            align-items:center;
            gap:16px;
            margin:15px 0;
        }

        .qty-btn {
            width:36px;
            height:36px;
            border-radius:50%;
            border:none;
            background:#2ecc71;
            color:white;
            font-size:20px;
            cursor:pointer;
            transition:.2s;
        }

        .qty-btn:hover {
            background:#219150;
        }

        .amount {
            font-weight:bold;
            margin:8px 0;
        }

        /* ===== BUTTON ===== */
        .add-btn {
            background:#27ae60;
            color:white;
            border:none;
            padding:10px 26px;
            border-radius:25px;
            cursor:pointer;
            transition:.25s;
        }

        .add-btn:hover {
            background:#1e8449;
            transform:scale(1.05);
        }

        .error {
            color:red;
            font-size:13px;
            display:none;
        }
    </style>
</head>

<body>

<!-- ===== HEADER ===== -->
<div class="header">
    <h1>üçé FruitMart</h1>
    <p>Fresh Fruits | Healthy Life</p>
</div>

<!-- ===== SEARCH ===== -->
<div class="search-box">
    <input type="text" id="searchInput" placeholder="üîç Search fruits...">
</div>

<!-- ===== QUOTES ===== -->
<div class="quotes" id="quoteBox">
    ‚ÄúAn apple a day keeps the doctor away üçé‚Äù
</div>

<!-- ===== PRODUCTS ===== -->
<div class="grid" id="productGrid">

    <div class="card"
         th:each="fruit : ${fruits}"
         th:data-name="${fruit.name.toLowerCase()}"
         th:data-price="${fruit.price}">

        <img th:src="${fruit.image}">
        <h3 th:text="${fruit.name}"></h3>

        <div class="price">
            ‚Çπ<span th:text="${fruit.price}"></span> /
            <span th:text="${fruit.unit}"></span>
        </div>

        <div class="qty-box">
            <button class="qty-btn dec">‚àí</button>
            <span class="qty">0</span>
            <button class="qty-btn inc">+</button>
        </div>

        <div class="amount">‚Çπ0</div>
        <div class="error">Select quantity</div>

        <button class="add-btn">Add to Cart</button>
    </div>

</div>

<script>
/* ===== QUOTES ROTATION ===== */
const quotes = [
    "An apple a day keeps the doctor away üçé",
    "Eat fruits, stay fit üí™",
    "Healthy outside starts from inside ü•≠",
    "Fresh fruits, fresh mind üçì",
    "Nature‚Äôs candy is the best candy üçå"
];

let qi = 0;
setInterval(() => {
    document.getElementById("quoteBox").innerText = quotes[qi++ % quotes.length];
}, 3000);

/* ===== SEARCH FILTER ===== */
document.getElementById("searchInput").addEventListener("keyup", function() {
    const value = this.value.toLowerCase();
    document.querySelectorAll(".card").forEach(card => {
        card.style.display = card.dataset.name.includes(value) ? "block" : "none";
    });
});

/* ===== CART LOGIC ===== */
document.querySelectorAll(".card").forEach(card => {

    let qty = 0;
    const price = parseInt(card.dataset.price);
    const name = card.querySelector("h3").innerText;

    const qtySpan = card.querySelector(".qty");
    const amountDiv = card.querySelector(".amount");
    const error = card.querySelector(".error");

    card.querySelector(".inc").onclick = () => {
        qty++;
        update();
    };

    card.querySelector(".dec").onclick = () => {
        if (qty > 0) qty--;
        update();
    };

    card.querySelector(".add-btn").onclick = () => {
        if (qty === 0) {
            error.style.display = "block";
            setTimeout(() => error.style.display = "none", 1200);
            return;
        }

        fetch(`/add-to-cart?name=${encodeURIComponent(name)}&qty=${qty}`)
            .then(r => r.json())
            .then(d => {
                if (d.redirect) {
                    window.location.href = d.redirect; // üîê login redirect
                }
            });
    };

    function update() {
        qtySpan.innerText = qty;
        amountDiv.innerText = "‚Çπ" + (qty * price);
    }
});
</script>

</body>
</html>